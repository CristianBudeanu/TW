@model IEnumerable<EasyBreath.Domain.Entities.Products.Product>
@using EasyBreath.web.Extensions

@{
     Layout = "~/Views/Shared/_Layout.cshtml";
     var user = System.Web.HttpContext.Current.GetMySessionObject();
}

<section class="container" style="margin-top: 60px; text-align: center">
     <table border="1" cellspacing="0">
          <tr>
               <th>
                    @Html.DisplayNameFor(model => model.Thumbnail)
               </th>
               <th>
                    @Html.DisplayNameFor(model => model.Name)
               </th>
               <th>
                    @Html.DisplayNameFor(model => model.Price)
               </th>
               <th>
                    @Html.DisplayNameFor(model => model.Amount)
               </th>

          </tr>

          @foreach (var item in Model)
          {
               <tr>
                    <td>
                         <img src="@item.Thumbnail" alt="Product Thumbnail" width="100" height="100">
                    </td>
                    <td>
                         @Html.DisplayFor(modelItem => item.Id)
                    </td>
                    <td>
                         @Html.DisplayFor(modelItem => item.Name)
                    </td>
                    <td>
                         @Html.DisplayFor(modelItem => item.Price)
                    </td>
                    <td>
                         @Html.DisplayFor(modelItem => item.Amount)
                    </td>
                    @if ((user != null) && (user.AccessLevel == EasyBreath.Domain.Enum.URole.ADMINISTRATOR))
                    {
                         <td>
                              @Html.ActionLink("Edit", "Edit", new { id = item.Id })
                              @Html.ActionLink("Delete", "Delete", new { id = item.Id })

                         </td>
                    }
                    @*<td>
               @Html.ActionLink("AddToCart","AddToCart", "Cart", new { productId = item.Id, userId = user.Id }, null) |

          </td>*@
               <td>
                    @using (Html.BeginForm("AddToCart", "Cart", new { productId = item.Id, userId = user.Id }, FormMethod.Post))
                    {
                         @Html.AntiForgeryToken()
                         <button type="submit" class="btn-link">Add to Cart</button>
                    }
               </td>
               </tr>
          }
          @if ((user != null) && (user.AccessLevel == EasyBreath.Domain.Enum.URole.ADMINISTRATOR))
          {
               <td>

                    @Html.ActionLink("Add Product", "CreatePage")

               </td>
          }

     </table>

</section>

@*<script>
    $(document).ready(function () {
        $("#addToCartButton").click(function (e) {
            e.preventDefault(); // Prevent the default link behavior

            var productId = $(this).attr("data-productId");
            var userId = $(this).attr("data-userId");

            // Send an AJAX request to the AddToCart action
            $.ajax({
                url: "/Cart/AddToCart",
                type: "POST",
                data: { productId: productId, userId: userId },
                success: function (response) {
                    // Handle the success response, if needed
                    console.log("Product added to cart successfully.");
                },
                error: function (xhr, status, error) {
                    // Handle the error response, if needed
                    console.log("Error adding the product to cart: " + error);
                }
            });
        });
    });
</script>*@